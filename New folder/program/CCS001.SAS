

/*-------------------------------------------------------------------------------------------
PROGRAM			: <CCS001.sas>
SAS VERSION		: 9.4
CLIENT			: Cliplab
CASE STUDY CODE         : CCS001
DESCRIPTION		: Listing of demographic data
AUTHOR			: Naresh Reddy Akkaluri
DATE COMPLETED	: 03Aug2024
PROGRAM INPUT	: demography.csv, visit.csv, demographics.sas7bdat
PROGRAM OUTPUT	: demo.sas7bdat, Demo.lst, demo2.xls, Demographics.rtf,BMI_Report.pdf 
PROGRAM LOG		: CCS001.log
REVIEWER NAME   : Dr.Proful
REVIEW DATE		: <ddmmmyyyy>
  Comments      :



PROGRAM ALGORITHM:
Task -1:
a) Create a dataset & named it as demo.(label : Demography)
b) Derive BMI variable as Weight (kg) / [Height (m) x Height (m)] & Label it as Body Mass Index.
c) Assign format to a Gender variable (1=Male, 2=Female).
d) Keep Subject Gender BMI.
e) Print the dataset to output window. (Lst file by using proc print to)
Generate BMI report category wise (proc report)
Task – 2:
a) Create a permanent library in SAS & store imported dataset.
b) List the variables (age, sex, location) with same (as mentioned) column order.
c) Generate an excel report using SAS ODS.
Task - 3:
a) Create listing from demographics dataset.
b) Change the format of the dates to Date9.
/*----------------------------------------------------------------------------------------------*/




/********************************TASK _1*****************************************/
/*Creating log file*/
proc printto log= "&output\CCS001.log" new;
run;


/*Creating macros for convience directory changes*/
%let output =D:\Clinical-Case-Studies\Case_study_1\output;
%let RawData=D:\Clinical-Case-Studies\Case_study_1\RawData ;
%let sasdatasets =D:\Clinical-Case-Studies\Case_study_1\SasDatasets;

/*improting Raw datasets in SAScode for making SAS Datasets*/

libname Data "&sasdatasets" ;
/*Create SAS dataset & named it as demo  ( Xlsx files)*/
proc import datafile="&RawData\demography.csv"
out= Data.demo 
dbms=csv replace;
run;

proc import datafile="&RawData\visit.xlsx"
out= Data.Visit (drop=F G H I J K L M N O P VAR17)  
dbms=xlsx replace;
run;

/*Caluculation of BMI from visit data set
  merging the data sets demo and visit (where patId is  common in both)*/
proc sort data=data.demo out=demo ;
by PATID ;
run;

proc sort data=data.visit out=visit ;
by PAT;
run;
/*merging the sorted data sets */
data demographics;
merge demo (in=a) visit(in=b rename=(pat=patid));
by patid;
if a and b;
run;

 
                  /* Gender format assignment */
proc format;
    value GenderFmt
        1 = 'Male'
        2 = 'Female';
run;
                 /*Caluculation of BMI and it stored in permanent library*/
data BMI;
set demographics;
BMI=(weight/(height*height)*703.1); /*703.1 added for Categories distribution*/
label BMI='Body Mass Index';
label patid=Subject;
label sexcd=Gender;
format sexcd genderFmt.;
format BMI 7.3;
keep patid sexcd BMI;
run;


proc printto print="&output\demo.lst" new;
proc print data=Bmi;
run;
proc printto;
run;


/*Category distribution

Category	 BMI range [BMI = (lb/in2) Ã— 703.1]
Very Obese	        from 35 And Above
Obese	                from 30 to 34.9
Overweight	        from 25 to 29.9
Normal	                from 18.5 to 24.9
Underweight	        from 16 to 18.4
Very Underweight	from 15 and below 
                                                 */



/*Generate BMI report category wise*/
ods pdf file= "&output\BMI_Report.pdf";
title 'BMI Report Categorywise';
footnote "Generated by Naresh Reddy Akkaluri on &sysday. &sysdate.";
proc report data=Bmi headline headskip;
column patid sexcd bmi category;
define patid/display 'Subject' center;
define sexcd/display 'Gender' center ;
define bmi/display 'Body Mass Index' center;
define category/computed 'Category' center;

compute category/length=17;
         if bmi>=35 then category='Very Obese';
         else if bmi>=30 and bmi<=34.9 then category='Obese';
         else if bmi>=25 and bmi<=29.9 then category='Overweight';
         else if bmi>=18.5 and bmi<=24.9 then category='Normal';
         else if bmi>=16 and bmi<=18.4 then category='Underweight';
         else if bmi<=15.9 then category='Very Underweight';
         endcomp;
run;
title;footnote;
ods pdf close;


/********************************TASK _2*****************************************/
data demo2 (keep= age sex location);
set demographics;
rename sexcd=sex site=location ;
format sexcd genderFmt.;
age=intck('year',birthdt,today());
run;


/*Generation of Excel report*/
ods listing close;
ods excel file="&output\demo2.xlsx";
proc print data=demo2;
run;
ods _all_ close;
ods listing;

/********************************TASK _3*****************************************/
proc format;
value ethnicity
1='Latino'
2='Not Hispanic';
value race
1='Asian' 2='White' 3='Black' 4='African' 5='Multi Racial' 6='Caucasian/Asian' 7='Bi-Racial(Korean/Caucasian)';
run;

ods listing close;
ods rtf file="&output\Demographics.rtf";
proc report data=demographics;
column site patid racecd ethnicity sexcd a birthdt age b start_date end_date c;
define site/display noprint; 
define patid/display noprint;
define racecd/display noprint;
define ethnicity/display noprint;
define sexcd/display noprint;
define a/computed 'Site\subjid\race\ethnicity\sex';

define birthdt/display noprint;
define age/display computed noprint;
define b/computed 'Brthdt\Age/(DD\MMM\YY)';

define start_date/display 'Start_date/(DD\MMM\YY)' format=date9.;
define end_date/display 'End_date/(DD\MMM\YY)' format=date9.;
define c/computed 'Usubjid/(site+subjid)';

compute a/character length=55;
a=catx('\',put(site,1.),put(patid,7.),put(racecd,race.),put(ethnicity,ethnicity.),put(sexcd,genderFmt.));
endcomp;

compute age;
age=intck('year',birthdt,today());
endcomp;

compute b/character length=12;
b=catx('\',put(birthdt,date9.),put(age,2.));
endcomp;

compute c/character length=5;
c=cats(put(site,1.),put(patid,4.));
endcomp;
run;

ods rtf close;
ods listing;


/*Closing log file*/
proc printto;
run;

/*Clearing all libraries specified at the beginning*/
libname out clear;


/*Clearing the work library*/
proc datasets lib=work kill;
quit;
